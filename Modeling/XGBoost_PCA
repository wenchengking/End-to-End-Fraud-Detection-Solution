{"cells":[{"cell_type":"code","execution_count":19,"metadata":{"executionInfo":{"elapsed":296,"status":"ok","timestamp":1678154617421,"user":{"displayName":"Weiyan Zhou","userId":"08728150346651717802"},"user_tz":360},"id":"k4B_PH4umFXR"},"outputs":[],"source":["# Libraries Loading\n","import zipfile\n","\n","import matplotlib.pyplot as plt\n","import numpy as np\n","import pandas as pd\n","import seaborn as sns\n","import statsmodels.api as sm\n","import xgboost as xgb\n","from matplotlib.ticker import MaxNLocator\n","from sklearn.decomposition import PCA\n","from sklearn.ensemble import RandomForestClassifier\n","from sklearn.metrics import (average_precision_score, confusion_matrix,\n","                             f1_score, log_loss, precision_score, recall_score,\n","                             roc_auc_score)\n","from sklearn.model_selection import GridSearchCV, KFold, cross_val_score\n","from sklearn.metrics import roc_auc_score\n","import pickle"]},{"cell_type":"code","execution_count":36,"metadata":{},"outputs":[],"source":["# same code - using PCA data\n","X_train_autoencoder = pd.read_pickle('PCA_X_train.pkl')\n","y_train_autoencoder = pd.read_pickle('PCA_y_train.pkl')\n","X_test_autoencoder = pd.read_pickle('PCA_X_test.pkl')\n","y_test_autoencoder = pd.read_pickle('PCA_y_test.pkl')"]},{"cell_type":"code","execution_count":37,"metadata":{},"outputs":[{"name":"stdout","output_type":"stream","text":["(796896, 80)\n","(796896,)\n","(103495, 80)\n","(103495,)\n"]}],"source":["print(X_train_autoencoder.shape)\n","print(y_train_autoencoder.shape)\n","print(X_test_autoencoder.shape)\n","print(y_test_autoencoder.shape)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bmj_5lB0mFXS"},"outputs":[],"source":["\"\"\"\n","# read in data from PCA\n","X_train_pca = pd.read_pickle('PCA_X_train.pkl')\n","y_train_pca = pd.read_pickle('PCA_y_train.pkl')\n","X_test_pca = pd.read_pickle('PCA_X_test.pkl')\n","y_test_pca = pd.read_pickle('PCA_y_test.pkl')\n","\n","\n","# read in data from Autoencoder\n","X_train_autoencoder = pd.read_pickle('AC_X_train.pkl')\n","y_train_autoencoder = pd.read_pickle('AC_y_train.pkl')\n","X_test_autoencoder = pd.read_pickle('AC_X_test.pkl')\n","y_test_autoencoder = pd.read_pickle('AC_y_test.pkl')\n","\"\"\""]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":9648,"status":"ok","timestamp":1678154631138,"user":{"displayName":"Weiyan Zhou","userId":"08728150346651717802"},"user_tz":360},"id":"Cqz6qtVxmFXT","outputId":"ad3db86d-ecda-4d06-d128-16c341fedd5d"},"outputs":[],"source":["\"\"\"\n","url = 'https://drive.google.com/file/d/1E9bFoMAwMVPMkZHmMQfWvSgaWoCLtKp4/view?usp=share_link'\n","url = 'https://drive.google.com/uc?id=' + url.split('/')[-2]\n","y_test_autoencoder = pd.read_pickle(url)\n","\n","url = 'https://drive.google.com/file/d/1dknbQLJhQsbSFDNIpwjxZQwPc3fF14yF/view?usp=share_link'\n","url = 'https://drive.google.com/uc?id=' + url.split('/')[-2]\n","y_train_autoencoder = pd.read_pickle(url)\n","\n","\n","url = 'https://drive.google.com/file/d/105vmXogIQU8srmtdzfCHYQ9G-T7Iu5hl/view?usp=share_link'\n","url = 'https://drive.google.com/uc?id=' + url.split('/')[-2]\n","X_test_autoencoder = pd.read_pickle(url)\n","\n","url = 'https://drive.google.com/file/d/1QemU274E0c14R8uknuipP20rNgDSLzcg/view?usp=share_link'\n","url = 'https://drive.google.com/uc?id=' + url.split('/')[-2]\n","X_train_autoencoder = pd.read_pickle(url)\n","\"\"\""]},{"cell_type":"markdown","metadata":{"id":"UhLRU-1OmFXT"},"source":["## XGBoost Classifier (Autoencoder)"]},{"cell_type":"code","execution_count":38,"metadata":{"id":"GeGTz-ixmFXT"},"outputs":[{"name":"stdout","output_type":"stream","text":["Best hyperparameters: {'learning_rate': 0.1, 'max_depth': 7, 'n_estimators': 150}\n","Best cross-validation AUC score: 0.9896799582379633\n"]}],"source":["# Define the XGBoost model\n","xgb_model = xgb.XGBClassifier()\n","\n","# Define the hyperparameters to be tuned\n","parameters = {\n","    'learning_rate': [0.1, 0.01, 0.001],\n","    'max_depth': [3, 5, 7],\n","    'n_estimators': [50, 100, 150]\n","}\n","\n","\n","# Create a GridSearchCV object\n","xgb_grid = GridSearchCV(xgb_model, parameters, cv=3, n_jobs=-1)\n","\n","# Fit the GridSearchCV object to the training data\n","xgb_grid.fit(X_train_autoencoder, y_train_autoencoder)\n","             \n","#the best model in \n","print('Best hyperparameters:', xgb_grid.best_params_)\n","print('Best cross-validation AUC score:', xgb_grid.best_score_)"]},{"cell_type":"code","execution_count":39,"metadata":{},"outputs":[{"data":{"text/plain":["{'learning_rate': 0.1, 'max_depth': 7, 'n_estimators': 150}"]},"execution_count":39,"metadata":{},"output_type":"execute_result"}],"source":["best_params = xgb_grid.best_params_\n","best_params"]},{"cell_type":"code","execution_count":40,"metadata":{"id":"rm6_nw-2mFXU"},"outputs":[],"source":["#retrain the model by using all data\n","xgboost_retrain = xgb.XGBClassifier(learning_rate =  best_params['learning_rate'], max_depth =  best_params['max_depth'], n_estimators = best_params['n_estimators']) #change it after trading\n","xgboost_retrain.fit(X_train_autoencoder, y_train_autoencoder)\n","yhat_test = xgboost_retrain.predict(X_test_autoencoder)"]},{"cell_type":"code","execution_count":41,"metadata":{"id":"d9LssPeOokWx"},"outputs":[{"name":"stdout","output_type":"stream","text":["ROC AUC for XGBoost in test dataset : 0.5000\n"]}],"source":["#AUC performance in test set\n","ROC_AUC_XGBOOST = roc_auc_score(y_test_autoencoder, yhat_test)\n","print('ROC AUC for XGBoost in test dataset : {:.4f}'.format(ROC_AUC_XGBOOST))"]},{"cell_type":"code","execution_count":42,"metadata":{"id":"7Ud1c6QfmFXU"},"outputs":[],"source":["#convert to pickle file for latter running\n","pickle.dump(xgboost_retrain, open('XGBoostModel-PCA.pkl', 'wb'))"]},{"cell_type":"code","execution_count":47,"metadata":{},"outputs":[{"data":{"text/plain":["1.0"]},"execution_count":47,"metadata":{},"output_type":"execute_result"}],"source":["# calculate the fnr and fpr\n","def calculate_fpr_fnr(y_test, yhat_test):\n","    tn, fp, fn, tp = confusion_matrix(y_test, yhat_test).ravel()\n","    fpr = fp / (fp + tn)\n","    fnr = fn / (fn + tp)\n","    return fpr, fnr\n","\n","fpr, fnr = calculate_fpr_fnr(y_test_autoencoder, yhat_test)\n","fnr"]},{"cell_type":"code","execution_count":54,"metadata":{},"outputs":[{"data":{"text/plain":["0    99613\n","1     3882\n","Name: isFraud, dtype: int64"]},"execution_count":54,"metadata":{},"output_type":"execute_result"}],"source":["y_test_autoencoder.value_counts()"]}],"metadata":{"accelerator":"GPU","colab":{"provenance":[]},"gpuClass":"standard","kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.6"},"orig_nbformat":4},"nbformat":4,"nbformat_minor":0}
